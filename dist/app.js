!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t){document.addEventListener("click",function(e){let t=e.target;if("tab"!==t.dataset.role)return;[].forEach.call(t.parentElement.children,function(e){e.classList.remove("active")}),t.classList.add("active");let s=document.querySelector(t.dataset.view);s&&([].forEach.call(s.parentElement.children,e=>{e.style.display="none"}),s.style.display="block")})},function(e,t,s){"use strict";s.r(t);s(0);const i="https://qq-music-api.now.sh",n="https://qq-music-api.now.sh/top",r="https://qq-music-api.now.sh/lyrics";class l{constructor(e={}){this.$el=e.el,this.slides=e.slides,this.interval=e.interval||3e3,this.index=0,this.render(),this.start(),console.log("el",this.$el)}render(){this.$el.innerHTML='<div class="qq-slider-wrap"></div>',this.$wrap=this.$el.firstElementChild,this.$wrap.style.width=`${100*this.slides.length}%`,this.$wrap.innerHTML=this.slides.map(e=>`<div class="qq-slider-item">\n                <a href="${e.link}">\n                    <img src="${e.image}">\n                </a>\n            </div>`).join("")}start(){setInterval(this.next.bind(this),this.interval)}next(){if(this.index+=1,this.index===this.slides.length)return this.$wrap.style.transform="translate(0)",void(this.index=0);let e=`-${this.index*(100/this.slides.length)}%`;this.$wrap.style.transform=`translate(${e})`}}function a(e){let t=[].slice.call(e),s=_.throttle(function(){if(console.log(new Date),0===t.length)return window.removeEventListener("scroll",s);(t=t.filter(e=>e.classList.contains("lazyload"))).forEach(e=>{(function(e){let{top:t,left:s,right:i,bottom:n}=e.getBoundingClientRect(),r=document.documentElement.clientWidth,l=document.documentElement.clientHeight;return(t>0&&t<l||n>0&&n<l)&&(s>0&&s<r||i>0&&i<r)})(e)&&function(e){let t=new Image;t.src=e.dataset.src,t.onload=function(){e.src=t.src,e.classList.remove("lazyload")}}(e)})},1e3);window.addEventListener("scroll",s),window.dispatchEvent(new Event("scroll"))}class o{constructor(e){this.$el=e,this.$el.innerHTML='<div class="player-lyrics-lines"></div>',this.$lines=this.$el.querySelector(".player-lyrics-lines"),this.text="",this.index=0,this.elapsed=0,this.lyrics=[],this.reset(this.text)}formatText(e){let t=document.createElement("div");return t.innerHTML=e,t.innerText}reset(e){this.pause(),this.index=0,this.elapsed=0,this.$lines.style.transform="translateY(0)";let t=this.$lines.querySelector(".active");console.log("ac",t),t&&t.classList.remove("active"),e&&(this.text=this.formatText(e)||"",this.lyrics=this.text.match(/^\[\d{2}:\d{2}.\d{2}\](.+)$/gm)||[],this.lyrics.length&&this.render()),this.lyrics.length&&(this.render(),this.$lines.children[this.index].classList.add("active"))}update(){if(this.elapsed+=1,this.index===this.lyrics.length-1)return this.reset();for(let e=this.index+1;e<this.lyrics.length;e++){let t=this.getSeconds(this.lyrics[e]);if(this.elapsed===t&&(!this.lyrics[e+1]||this.elapsed<this.getSeconds(this.lyrics[e+1]))){this.$lines.children[this.index].classList.remove("active"),this.$lines.children[e].classList.add("active"),this.index=e;break}}if(this.index>2){let e=-(this.index-2)*this.LINE_HEIGHT;this.$lines.style.transform=`translateY(${e}px)`}}render(){let e=this.lyrics.map(e=>`\n        <div class="player-lyrics-line">${e.slice(10)}</div>\n        `).join("");this.$lines.innerHTML=e}start(){this.pause(),this.intervalId=setInterval(this.update.bind(this),1e3)}restart(){this.reset(),this.start()}getSeconds(e){return+e.replace(/^\[(\d{2}):(\d{2}).*/,(e,t,s)=>60*+t+ +s)}pause(){clearInterval(this.intervalId)}}o.prototype.LINE_HEIGHT=42;class h{constructor(e,t,s){console.log("progress",e),this.$el=e,this.elapsed=0,this.duration=t||0,this.progress=0,this.render(),this.$progress=this.$el.querySelector(".progress-bar-progress"),this.$elapsed=this.$el.querySelector(".progress-elapsed"),this.$duration=this.$el.querySelector(".progress-duration"),this.$elapsed.innerText=this.formatTime(this.elapsed),this.$duration.innerText=this.formatTime(this.duration),s&&this.start()}start(){this.pause(),this.intervalId=setInterval(this.update.bind(this),500)}pause(){clearInterval(this.intervalId)}update(){this.elapsed+=.5,this.elapsed>=this.duration&&this.reset(),this.progress=this.elapsed/this.duration,this.$progress.style.transform=`translate(${100*this.progress-100}%)`,this.$elapsed.innerText=this.formatTime(this.elapsed)}reset(e){this.pause(),this.elapsed=0,this.progress=0,e&&(this.duration=+e,this.$duration.innerText=this.formatTime(this.duration))}render(){this.$el.innerHTML='\n          <div class="progress-time progress-elapsed"></div>\n            <div class="progress-bar">\n              <div class="progress-bar-progress"></div>\n            </div>\n          <div class="progress-time progress-duration"></div>\n        '}formatTime(e){let t=Math.floor(e/60),s=Math.floor(e%60);return t<10&&(t="0"+t),s<10&&(s="0"+s),`${t}:${s}`}}new class{constructor(e){this.$el=e}launch(){return fetch(i).then(e=>e.json()).then(e=>this.json=e).then(()=>this.render()),this}render(){this.renderSlider(this.json.data.slider),this.renderRadios(this.json.data.radioList),a(document.querySelectorAll(".lazyload"))}renderSlider(e){this.slider=new l({el:this.$el.querySelector("#slider"),slides:e.map(e=>({link:e.linkUrl.replace("http://","https://"),image:e.picUrl.replace("http://","https://")}))})}renderRadios(e){console.log(e),this.$el.querySelector(".radios .list").innerHTML=e.map(e=>`<div class="list-item">\n                <div class="list-media">\n                    <img class="lazyload" data-src="${e.picUrl}">\n                    <span class="icon icon-play"></span>\n                </div>\n                <div class="list-title">${e.Ftitle}</div>\n            </div>`).join("")}}(document.querySelector(".rec-view")).launch(),new class{constructor(e){this.$el=e}launch(){return fetch(n).then(e=>e.json()).then(e=>this.list=e.data.topList).then(e=>this.render(e)),this}render(e){this.$el.querySelector(".rank-list").innerHTML=e.map(e=>`<li class="rank-item">\n                    <div class="item-mian">\n                        <a href="#" class="item-media">\n                            <img class="lazyload" data-src="${e.picUrl}" src="https://y.gtimg.cn/music/common/upload/iphone_order_channel/toplist_4_300_215830524.jpg?max_age=2592000">\n                            <span class="listen_count"><i class="icon icon_listen"></i>${e.listenCount}ä¸‡</span>\n                        </a>\n                        <div class="item-info">\n                            <div class="info-cont">\n                                <h3 class="info-tit">${e.topTitle}</h3>\n                                ${this.songlist(e.songList)}\n                            </div>\n                            <i class="info-arrow"></i>\n                        </div>\n                    </div>\n                </li>`).join(""),a(this.$el.querySelectorAll(".rank-list .lazyload"))}songlist(e){return e.map((e,t)=>`<p>${t+1}<span class="text_name">${e.songname}</span>- ${e.singername}</p>`).join("")}}(document.querySelector(".rank-view")).launch(),new class{constructor(e){this.$el=e,this.$input=this.$el.querySelector("#search"),this.$songs=this.$el.querySelector(".song-list"),this.$input.addEventListener("keyup",this.onKeyUp.bind(this)),this.keyword="",this.page=1,this.songs=[],this.perpage=20,this.nomore=!1,this.fetching=!1,this.onscroll=this.onScroll.bind(this),window.addEventListener("scroll",this.onscroll)}onKeyUp(e){let t=e.target.value.trim();if(!t)return this.reset();13===e.keyCode&&(this.loading(),this.search(t))}onScroll(e){if(this.nomore)return window.removeEventListener("scroll",this.onscroll);document.documentElement.clientHeight+pageYOffset>document.body.scrollHeight-50&&this.search(this.keyword,this.page+1)}reset(){this.page=1,this.keyword="",this.songs=[],this.nomore=!1,this.$songs.innerHTML="",this.$el.querySelector(".search-loading").classList.remove("show")}search(e,t){this.fetching||(this.keyword=e,this.fetching=!0,fetch(`https://qq-music-api.now.sh/search?keyword=${this.keyword}&page=${t||this.page}`).then(e=>e.json()).then(e=>(this.page=e.data.song.curpage,this.nomore="no results"===e.message,this.songs.push.apply(this.songs,e.data.song.list),e.data.song.list)).then(e=>this.append(e)).then(()=>this.fetching=!1).catch(()=>this.fetching=!1))}loading(){this.$el.querySelector(".search-loading").classList.add("show")}append(e){let t=e.map(e=>{let t=e.singer.map(e=>e.name).join(" ");return`\n              <a class="song-item"\n                 href="#player?artist=${t}&songid=${e.songid}&songname=${e.songname}&albummid=${e.albummid}&duration=${e.interval}&songmid=${e.songmid}">\n                <i class="icon icon-music"></i>\n                <div class="song-name ellipsis">${e.songname}</div>\n                <div class="song-artist ellipsis">${t}</div>\n              </a>`}).join("");this.$songs.insertAdjacentHTML("beforeend",t)}done(){this.fetching=!1,this.nomore?(this.$el.querySelector(".icon-jiazai").style.display="none",this.$el.querySelector(".loading-text").style.display="none",this.$el.querySelector(".loading-done").style.display="block",this.$el.querySelector(".search-loading").classList.add("show")):this.$el.querySelector(".search-loading").classList.remove("show")}}(document.querySelector(".search-view"));let c=new class{constructor(e){this.$el=e,this.$el.addEventListener("click",this),this.$audio=this.createAudio(),this.lyrics=new o(this.$el.querySelector(".player-lyrics")),this.progress=new h(this.$el.querySelector(".progress"))}createAudio(){return this.$audio=document.createElement("audio"),this.$audio.id=`player-${Math.floor(100*Math.random())}-${+new Date}`,this.$audio.addEventListener("ended",()=>{this.$audio.play(),this.lyrics.restart(),this.progress.restart()}),document.body.appendChild(this.$audio),this.$audio}handleEvent(e){let t=e.target;switch(!0){case t.matches(".icon-play"):this.onPlay(e);break;case t.matches(".icon-pause"):this.onPause(e);break;case t.matches(".icon-list"):this.hide()}}onPlay(e){this.$audio.play(),this.lyrics.start(),this.progress.start(),e.target.classList.remove("icon-play"),e.target.classList.add("icon-pause")}onPause(e){this.$audio.pause(),this.lyrics.pause(),this.progress.pause(),e.target.classList.remove("icon-pause"),e.target.classList.add("icon-play")}play(e={}){if(!e)return;this.$el.querySelector(".song-name").innerText=e.songname,this.$el.querySelector(".song-artist").innerText=e.artist,this.progress.reset(e.duration);let t=function(e){return`https://y.gtimg.cn/music/photo_new/T002R150x150M000${e}.jpg`}(e.albummid);this.$el.querySelector(".album-cover").src=t,this.$el.querySelector(".player-background").style.backgroundImage=`url(${t})`,e.songid&&(this.songid!==e.songid&&(this.$el.querySelector(".icon-action").className="icon-action icon-play"),this.songid=e.songid,this.$audio.src=function(e){return`http://ws.stream.qqmusic.qq.com/C100${e}.m4a?fromtag=0&guid=126548448`}(e.songmid),this.fetching=!0,fetch(function(e){return`${r}?id=${e}`}(this.songid)).then(e=>e.json()).then(e=>e.lyric).then(e=>this.lyrics.reset(e)).catch(()=>{}).then(()=>this.fetching=!1)),this.show()}show(){this.$el.classList.add("show"),document.body.classList.add("noscroll")}hide(){this.$el.classList.remove("show"),document.body.classList.remove("noscroll")}}(document.querySelector("#player")),d=document.querySelector(".show-player"),u=document.querySelector("#player");function p(){let e=location.hash;if(/^#player\?.+/.test(e)){let t=e.slice(e.indexOf("?")+1).match(/(\w+)=([^&]+)/g),s=t&&t.reduce((e,t)=>{let s=t.split("=");return e[s[0]]=decodeURIComponent(s[1]),e},{});c.play(s)}else c.hide()}console.log(u),d.addEventListener("click",function(){u.classList.add("show")}),p(),window.addEventListener("hashchange",p),window.slider=slider,window.player=c}]);